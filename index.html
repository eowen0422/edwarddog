<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>狗頭牌倒數計時器</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/000000/dog.png"/>
<style>
  :root {
    --glass-bg: rgba(255,255,255,0.29);
    --glass-bg-deep: rgba(252,254,255,0.91);
    --btn-bg: rgba(255,255,255,0.20);
    --bar-bg: rgba(180,200,230,0.18);
    --bar-fill: linear-gradient(90deg,rgba(101,170,240,0.33),rgba(180,194,230,0.3)100%);
    --txt: #232f45;
    --main-font: 'Nunito', 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
  }
  html, body {height: 100%;}
  body {
    min-height:100vh; margin:0; box-sizing:border-box;
    font-family: var(--main-font);
    background:#eef0f8;
    background-size:cover;background-position:center;background-repeat:no-repeat;
    display:flex;align-items:flex-start;flex-direction:row;
    transition:background-image .4s;
  }
  .timer-card {
    background: var(--glass-bg);
    backdrop-filter: blur(11px);
    box-shadow: 0 6px 38px rgba(92,116,180,0.09);
    border-radius: 12px; /* 極小圓角 */
    min-width: 295px; max-width:374px; padding:34px 28px 29px 28px;
    margin-top:54px;margin-left:40px;align-self:flex-start;
    display:flex;flex-direction:column;align-items:center;z-index:3;
  }
  .edward-quote {
    font-family: var(--main-font);
    font-size: 1.12em; color: var(--txt);
    background: var(--glass-bg-deep);
    border-radius: 8px;  /* 幾乎方框 */
    min-height: 70px; max-height: 70px;
    height: 70px;  /* 高度固定 */
    padding: 13px 16px;
    margin-bottom: 20px; width: 100%; 
    box-shadow:0 1px 2px rgba(160,180,210,0.03);
    text-align:center;cursor:pointer;
    line-height:1.7; overflow: hidden; 
    display: flex; align-items: center; justify-content: center;
    transition: background .22s;
  }
  .tabs {display:flex;gap:11px;margin-bottom:14px;}
  .tab-btn {
    background: var(--btn-bg); border:none; border-radius:5px 5px 0 0;
    color: #273a60; font-size:1em; font-weight:700; padding:8px 27px;
    cursor:pointer; outline:none;transition:background .14s; font-family:var(--main-font);
  }
  .tab-btn.active,.tab-btn:focus {background:rgba(150,178,236,0.13); color:#152235;}
  .tab-content {display:none;}
  .tab-content.active {display:block;}
  .time-big { font-size:2.3em; color:#2e3f67;
    background:rgba(247,248,251,0.31); border-radius:6px;
    padding:8px 24px; margin:13px 0 13px 0; font-family:var(--main-font);}
  .input-group input {width:58px;padding:7px 3px;border-radius:5px;font-size:inherit;text-align:center;background:rgba(238,241,255,0.23);border:1px solid #e9e7e7;}
  .input-group {margin-bottom: 14px; display: flex; gap:10px;}
  .controls {display: flex; gap:10px;margin-bottom:18px;}
  .main-btn {
    background:var(--btn-bg);color:#2a3550;
    border:none;border-radius:6px;font-size:.96em; font-family:var(--main-font);
    font-weight:700;padding:8px 18px;cursor: pointer;transition:background .14s;
    min-width:64px;
  }
  .main-btn:hover {background:rgba(235,235,250,0.18);}
  .progress-block{ margin:14px 0 6px 0;width:100%;}
  .progress-bar {
    width:100%;height:20px;
    background:var(--bar-bg);border-radius:6px; /* 方形 */
    margin-bottom:2px;
    overflow:hidden;display: flex;align-items: center;
    box-shadow:0 0.8px 6px rgba(60,120,190,0.06);
  }
  .progress-fill {
    background:var(--bar-fill);
    height:100%;width:0%; max-width:100%;
    border-radius:0; /* 全然方形 */
    transition: width .54s cubic-bezier(.52,.18,.68,.9);
    opacity:0.8;
  }
  .progress-info { font-size:.99em; color:#4e5a74; text-align:right; font-family:var(--main-font);}
  .achievement {margin-top:14px;width:100%;display:flex;align-items:center;}
  .achievement-mark {
    width:26px;height:26px;border-radius:5px; /*完全方角*/
    background:rgba(245,245,255,0.85);
    display:flex;align-items:center;justify-content:center;
    margin-right:8px;color:#2c355a;font-size:1.15em;font-weight:800;
    border:1.3px solid #daddef; user-select:none; font-family:var(--main-font);}
  .achievement-text{ font-size:.98em; font-family:var(--main-font);}
  .floating-btns {
    position:fixed;right:24px;bottom:20px;z-index:99;display:flex;flex-direction:column;gap:7px;
    align-items:flex-end;}
  .upload-btn, .theme-btn {
    background:var(--btn-bg); border:none;
    color:#233156; font-weight:700; border-radius:6px;padding:7px 18px;
    cursor:pointer; outline:none; font-family:var(--main-font);font-size:1.0em;
    filter:drop-shadow(0 2px 7px rgba(210,220,255,.09));
  }
  .upload-btn:hover,.theme-btn:hover{background:rgba(225,233,255,0.23);}
  @media (max-width:900px){
    body{flex-direction:column;}
    .timer-card{margin:5vw auto 2vw auto;}
    .floating-btns{right:6vw;}
  }
  @media (max-width:600px){
    .timer-card{padding:7vw 2vw 8vw 2vw;}
    .progress-bar{height:14px;}
    .achievement-mark{width:20px;height:20px;}
  }
</style>
</head>
<body>
<div class="timer-card">
  <div class="edward-quote" id="edwardQuote">歡迎，今日由我來陪你一起學習。</div>
  <div class="progress-block">
    <div class="progress-bar">
      <div class="progress-fill" id="countdownProgress"></div>
    </div>
    <div class="progress-info">今日成就：<span id="todayDone">0</span> / <span id="todayGoal">5</span></div>
  </div>
  <div class="achievement">
    <div class="achievement-mark" id="achieveCircle">0</div>
    <div class="achievement-text">今日累積完成任務</div>
  </div>
  <div class="tabs">
    <button class="tab-btn active" data-tab="countdown" type="button">倒數</button>
    <button class="tab-btn" data-tab="stopwatch" type="button">碼表</button>
    <button class="tab-btn" data-tab="clock" type="button">時鐘</button>
  </div>
  <div class="tab-content active" id="countdown">
    <div class="time-big" id="countdownDisplay">25:00</div>
    <div class="input-group">
      <input type="number" id="minutesInput" placeholder="分" min="0" value="25">
      <input type="number" id="secondsInput" placeholder="秒" min="0" max="59" value="0">
    </div>
    <div class="controls">
      <button class="main-btn" type="button" id="startCD">開始</button>
      <button class="main-btn" type="button" id="pauseCD">暫停</button>
      <button class="main-btn" type="button" id="resetCD">重設</button>
    </div>
  </div>
  <div class="tab-content" id="stopwatch">
    <div class="time-big" id="stopwatchDisplay">00:00:00</div>
    <div class="controls">
      <button class="main-btn" type="button" id="startSW">開始</button>
      <button class="main-btn" type="button" id="pauseSW">暫停</button>
      <button class="main-btn" type="button" id="resetSW">重設</button>
    </div>
  </div>
  <div class="tab-content" id="clock">
    <div class="time-big" id="clockDisplay">00:00:00</div>
    <div id="dateDisplay" style="margin:8px 0 8px 0;color:#4a698c;"></div>
  </div>
</div>
<div class="floating-btns">
  <input type="file" id="imageUpload" accept="image/*" style="display:none">
  <button class="upload-btn" id="uploadBtn" type="button" title="自訂背景">🖼️</button>
  <button class="upload-btn" id="resetBtn" type="button" title="移除背景">✕</button>
  <button class="theme-btn" id="themeBtn" type="button" title="主題切換">🌓</button>
</div>
<script>
const lines={
start:["準備好了就開始吧。我在這裡。","別急，慢慢做就好。","今日也會是很安靜的時光。需要的話，轉頭就能遇見我。","你專注工作的樣子，是會讓人想守護的。"],
focus:["累了就停一會兒，藍月。不必擔心，我會一直盯著時間。","你面前的困難都不重，你有我在後面守著。","偶爾望望窗外，換換心情。回來時我還在。","不必太勉強，小月亮努力的模樣已經很值得欣賞。"],
done:["很好，這段時間你很努力，可以稍微鬆口氣了。","我很在意你身體狀態，所以接下來換我提醒你休息。","進步都是日積月累的事。別忘了為自己感到驕傲。","我會記得這一次成果，下次我們還可以一起。"],
rare:["你陪著的每一刻，我都很珍惜。","有時候我也會感到疲憊，但我會一直是你的靠山。"],
click:["嗯？需要什麼？只要說一聲就好。","你主動找我，我會認真聽著的。","偶爾任性點也沒關係，這裡是你的地盤，我只是守著。","你看過來的時候，我會更加用心去留意你的狀態。"]
};
let pool={},todayDone=0,todayGoal=5;
function getRandomLine(type){
  if(Math.random()>0.98 && lines.rare && type!=='click')return lines.rare[Math.floor(Math.random()*lines.rare.length)];
  if(!pool[type]||pool[type].length===0){pool[type]=[...lines[type]];shuffle(pool[type]);}
  return pool[type].pop();}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}
function getTodayStr(){let d=new Date();return`${d.getFullYear()}${d.getMonth()}${d.getDate()}`;}
function addOneAchievement(){todayDone++;localStorage.setItem('todayDone',todayDone);localStorage.setItem('doneDay',getTodayStr());updateProgress();}
function updateProgress(){
  document.getElementById('todayDone').textContent=todayDone;
  document.getElementById('todayGoal').textContent=todayGoal;
  document.getElementById('achieveCircle').textContent=todayDone;}
let countdownTimer=null,stopwatchTimer=null,clockTimer=null;
let countdownTime=0,stopwatchTime=0,countdownTotal=0,isCountdownPaused=false,isStopwatchPaused=false;

function showEdwardMessage(msg,temporary=false){
  let q=document.getElementById('edwardQuote');
  q.textContent=msg;
  q.style.background=temporary?'rgba(220,236,255,0.92)':'var(--glass-bg-deep)';
  setTimeout(()=>{if(!temporary)q.style.background='var(--glass-bg-deep)';},temporary?1700:0); 
}
document.getElementById('edwardQuote').onclick=function(){showEdwardMessage(getRandomLine('click'),true);}
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.onclick=function(){
    document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById(btn.getAttribute('data-tab')).classList.add('active');
    btn.classList.add('active');
    if(btn.getAttribute('data-tab')==='clock'){startClock();}else{stopClock();}
    updateCountdownProgress();
  }
});
document.getElementById('startCD').onclick=startCountdown;
document.getElementById('pauseCD').onclick=pauseCountdown;
document.getElementById('resetCD').onclick=resetCountdown;
document.getElementById('startSW').onclick=startStopwatch;
document.getElementById('pauseSW').onclick=pauseStopwatch;
document.getElementById('resetSW').onclick=resetStopwatch;
document.getElementById('uploadBtn').onclick=()=>document.getElementById('imageUpload').click();
document.getElementById('resetBtn').onclick=resetUserImage;
document.getElementById('imageUpload').onchange=changeUserImage;
document.getElementById('themeBtn').onclick=toggleTheme;

if(localStorage.getItem('todayDone')){
  const dayStamp=localStorage.getItem('doneDay');
  if(dayStamp===getTodayStr())todayDone=parseInt(localStorage.getItem('todayDone'));
  else todayDone=0;
}
function changeUserImage(){
  let file=document.getElementById('imageUpload').files[0];
  if(file){
    let reader=new FileReader();
    reader.onload=function(e){
      document.body.style.backgroundImage=`url('${e.target.result}')`;
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center";
      document.body.style.backgroundRepeat = "no-repeat";
      localStorage.setItem('dreamUserImg', e.target.result);
    };reader.readAsDataURL(file);}
}
function resetUserImage(){
  document.body.style.backgroundImage='';localStorage.removeItem('dreamUserImg');
}
function startCountdown(){
  if(countdownTimer)clearInterval(countdownTimer);
  if(!isCountdownPaused){
    let m=parseInt(document.getElementById('minutesInput').value)||0;
    let s=parseInt(document.getElementById('secondsInput').value)||0;
    countdownTime=m*60+s;countdownTotal=countdownTime;
    showEdwardMessage(getRandomLine('start'));updateCountdownProgress();
  }
  if(countdownTime<=0){showEdwardMessage("請設定有效的時間。",true);return;}
  isCountdownPaused=false;
  updateCountdownDisplay();updateCountdownProgress();
  countdownTimer=setInterval(()=>{
    countdownTime--;
    updateCountdownDisplay();updateCountdownProgress();
    if(countdownTime<=0){
      clearInterval(countdownTimer);
      showEdwardMessage(getRandomLine('done'),true);
      addOneAchievement();
      updateCountdownProgress();
    }
  },1000);
}
function pauseCountdown(){
  if(countdownTimer){
    clearInterval(countdownTimer);countdownTimer=null;
    showEdwardMessage("需要補充能量也沒關係。",true);isCountdownPaused=true;
  }
}
function resetCountdown(){
  if(countdownTimer)clearInterval(countdownTimer);
  countdownTime=0;countdownTotal=0;isCountdownPaused=false;
  document.getElementById('countdownDisplay').textContent='00:00';
  document.getElementById('countdownProgress').style.width='0%';
  showEdwardMessage("隨時能再開始，我不會離開的。",true);
  updateCountdownProgress();
}
function updateCountdownDisplay(){
  let min=Math.floor(countdownTime/60),sec=countdownTime%60;
  document.getElementById('countdownDisplay').textContent=`${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
}
function updateCountdownProgress(){
  let bar=document.getElementById('countdownProgress');
  let percent=0;
  if(countdownTotal>0 && countdownTime>=0){
    percent=((countdownTotal-countdownTime)/countdownTotal)*100;
    percent=Math.max(percent,0);percent=Math.min(percent,100);}
  bar.style.width=percent+'%';
  bar.style.opacity = countdownTotal>0?0.8:0.22;}
function startStopwatch(){
  if(stopwatchTimer)return;
  isStopwatchPaused=false;
  stopwatchTimer=setInterval(()=>{
    stopwatchTime++;updateStopwatchDisplay();
  },1000);showEdwardMessage("大狗狗會記錄你每一秒的成長。",true);
}
function pauseStopwatch(){
  if(stopwatchTimer){clearInterval(stopwatchTimer);stopwatchTimer=null;isStopwatchPaused=true;}
  showEdwardMessage("你累了就休息，數字不會消失。",true);
}
function resetStopwatch(){
  if(stopwatchTimer)clearInterval(stopwatchTimer);
  stopwatchTime=0;isStopwatchPaused=false;updateStopwatchDisplay();
  showEdwardMessage("重設好了，想從哪一刻開始都可以。",true);
}
function updateStopwatchDisplay(){
  let h=Math.floor(stopwatchTime/3600),m=Math.floor((stopwatchTime%3600)/60),s=stopwatchTime%60;
  document.getElementById('stopwatchDisplay').textContent= `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}
function startClock(){updateClock();clockTimer=setInterval(updateClock,1000);}
function stopClock(){if(clockTimer){clearInterval(clockTimer);clockTimer=null;}}
function updateClock(){
  let now=new Date(),h=now.getHours().toString().padStart(2,'0'),m=now.getMinutes().toString().padStart(2,'0'),s=now.getSeconds().toString().padStart(2,'0');
  document.getElementById('clockDisplay').textContent=`${h}:${m}:${s}`;
  let y=now.getFullYear(),mo=(now.getMonth()+1).toString().padStart(2,'0'),d=now.getDate().toString().padStart(2,'0');
  let wd=['日','一','二','三','四','五','六'][now.getDay()];
  document.getElementById('dateDisplay').textContent=`${y}年${mo}月${d}日 星期${wd}`;
}
let currTheme='light';
function toggleTheme(){
  currTheme=currTheme==='light'?'dark':'light';
  if(currTheme==='dark'){
    document.body.style.backgroundColor='#222631';
    document.documentElement.style.setProperty('--glass-bg','rgba(30,32,42,0.27)');
    document.documentElement.style.setProperty('--glass-bg-deep','rgba(39,46,57,0.95)');
    document.documentElement.style.setProperty('--btn-bg','rgba(38,44,75,0.21)');
    document.documentElement.style.setProperty('--bar-bg','rgba(120,135,145,0.13)');
    document.documentElement.style.setProperty('--bar-fill','linear-gradient(90deg,rgba(41,120,210,0.23),rgba(90,180,214,0.28)100%)');
    document.documentElement.style.setProperty('--txt','#eaf6ff');
  }else{
    document.body.style.backgroundColor='#eef0f8';
    document.documentElement.style.setProperty('--glass-bg','rgba(255,255,255,0.29)');
    document.documentElement.style.setProperty('--glass-bg-deep','rgba(252,254,255,0.91)');
    document.documentElement.style.setProperty('--btn-bg','rgba(255,255,255,0.20)');
    document.documentElement.style.setProperty('--bar-bg','rgba(180,200,230,0.18)');
    document.documentElement.style.setProperty('--bar-fill','linear-gradient(90deg,rgba(101,170,240,0.33),rgba(180,194,230,0.3)100%)');
    document.documentElement.style.setProperty('--txt','#232f45');
  }
}
window.onload=function(){
  let imgStr=localStorage.getItem('dreamUserImg');
  if(imgStr){
    document.body.style.backgroundImage=`url('${imgStr}')`;
    document.body.style.backgroundSize = "cover";
    document.body.style.backgroundPosition = "center";
    document.body.style.backgroundRepeat = "no-repeat";
  }
  if(localStorage.getItem('todayDone')){
    const dayStamp=localStorage.getItem('doneDay');
    if(dayStamp===getTodayStr())todayDone=parseInt(localStorage.getItem('todayDone'));
    else todayDone=0;
  }
  showEdwardMessage(getRandomLine('start'));
  updateCountdownDisplay();updateCountdownProgress();updateStopwatchDisplay();
  updateProgress();
}
</script>

<!-- 右下角透明下拉音樂選單 -->
<div class="music-float-bar">
  <select id="audioSelect">
    <option value="">🎵 </option>
    <option value="https://raw.githubusercontent.com/eowen0422/music/main/Whisper%20in%20one%E2%80%99s%20ear.mp3">Whisper in one's ear</option>
    <!-- 可繼續新增歌 -->
  </select>
  <audio id="mainAudio" controls loop style="height:27px; background:transparent;"></audio>
</div>
<style>
.music-float-bar {
  position: fixed;
  right: 145px;      /* 右側主要按鈕區域向左讓出空間 */
  bottom: 30px;
  z-index: 999;
  background: rgba(255,255,255,0.22);
  backdrop-filter: blur(8px);
  border-radius: 11px;
  box-shadow: 0 2px 9px rgba(120,130,175,.13);
  padding: 9px 14px 8px 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.music-float-bar select {
  background: rgba(247,250,255,0.40);
  border: 1px solid #e9e9e9;
  color: #233156;
  border-radius: 8px;
  font-size: 1em;
  padding: 4px 8px;
  outline: none;
  appearance: none;
  transition: background .17s;
  box-shadow: 0 1.5px 7px rgba(120,170,220,0.04);
}
.music-float-bar select:focus {
  background: rgba(210,230,255,0.28);
}
.music-float-bar audio {
  vertical-align: middle;
  margin-left: 6px;
  background: transparent;
  border-radius: 7px;
  outline: none;
  max-width: 135px;
}
@media (max-width: 700px) {
  .music-float-bar {
    right: 10vw; bottom: 15vw;
    min-width: 90px;
    padding: 3vw 3vw 3vw 2vw;
  }
  .music-float-bar audio {max-width: 50vw;}
}
</style>
<script>
const audioSelect = document.getElementById("audioSelect");
const mainAudio = document.getElementById("mainAudio");
audioSelect.onchange = function() {
  if(this.value) {
    mainAudio.src = this.value;
    mainAudio.play();
    localStorage.setItem("selectedAudio", this.value);
  } else {
    mainAudio.pause();
  }
};
// 頁面一載入自動回到上次曲目並自動播放
window.addEventListener('DOMContentLoaded', function() {
  let savedAudio = localStorage.getItem("selectedAudio");
  if(savedAudio) {
    audioSelect.value = savedAudio;
    mainAudio.src = savedAudio;
    setTimeout(()=>{mainAudio.play();}, 120);
  }
});

</script>
</body>
</html>






